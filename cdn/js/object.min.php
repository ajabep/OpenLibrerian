<?php

$configFile = '../offline/config.inc.php';

require $configFile;

header('Content-Type: application/javascript');
header('Last-Modified: ' . date ("F d Y H:i:s.", filemtime($configFile)) );

?>$(function(){$("[data-toggle=tooltip]").tooltip();$.editable.addInputType("autogrow",{element:function(a,c){var b=$("<textarea />");a.rows?b.attr("rows",a.rows):b.height(a.height);a.cols?b.attr("cols",a.cols):b.width(a.width);$(this).append(b);return b},plugin:function(a,c){$("textarea",this).autogrow(a.autogrow)}});$("h1 .editable").editable("<?php echo PREFIX_LINK; ?>ajax/editObject/",{indicator:"Saving ...",type:"text",name:"name",list:"tags",submit:"OK",cancel:"cancel",placeholder:"Double-click to name your file...",tooltip:"Double-click to edit...",event:"dblclick",submitdata:function(a,c){var b=$("h1").text(),e=$("h1 .editable").text(),b=$.trim(b.substr(e.length));return{id:document.getElementsByTagName("h1")[0].getAttribute("data-id-object"),ext:b,element:"nameFile"}},ajaxoptions:{dataType:"json",error:function(){},success:function(){}},always:function(a,c,b,e,d,f){d.editing=!1;e.tooltip&&d.setAttribute("title",e.tooltip);if("undefined"==typeof a.readyState){if(!0===a.status){d.innerHTML=a.result;$.trim(d.innerHTML)||(d.innerHTML=e.placeholder);return}a=b;c="server";b=translate("Server error. Try later.")}d.innerHTML=d.revert;$.trim(d.innerHTML)||(d.innerHTML=e.placeholder);200!=a.status&&(b="HTTP ERROR "+a.status+" : "+a.statusText);alert(translate("An error occured.\n\nType : {{errType}}\nDetails : {{error}}",{errType:c,error:b}))}});$(".description").editable("<?php echo PREFIX_LINK; ?>ajax/editObject/",{indicator:"Saving ...",type:"autogrow",name:"description",list:"tags",submit:"OK",cancel:"cancel",placeholder:"Double-click to describe your file...",tooltip:"Double-click to edit...",event:"dblclick",data:function(a,c){var b=a.replace(/<br>\r?\n?/gim,"\n"),b=b.replace(/<.*>/gim,""),b=b.replace(/&lt;/gim,"<");return b=b.replace(/&gt;/gim,">")},submitdata:function(){return{id:document.getElementsByTagName("h1")[0].getAttribute("data-id-object"),element:"description"}},ajaxoptions:{dataType:"json",error:function(){},success:function(){}},always:function(a,c,b,e,d,f){d.editing=!1;e.tooltip&&d.setAttribute("title",e.tooltip);if("undefined"==typeof a.readyState){if(!0===a.status){d.innerHTML=a.result;$.trim(d.innerHTML)||(d.innerHTML=e.placeholder);return}a=b;c="server";b=translate("Server error. Try later.")}d.innerHTML=d.revert;$.trim(d.innerHTML)||(d.innerHTML=e.placeholder);200!=a.status&&(b="HTTP ERROR "+a.status+" : "+a.statusText);alert(translate("An error occured.\n\nType : {{errType}}\nDetails : {{error}}",{errType:c,error:b}))}});$("#addTagBtn").on("click",function(){document.getElementById("addTagInput").value="";$("#addTagModal").modal()});$(".tagList").find("[data-delete].glyphicon.glyphicon-remove-sign").on("click",function(){deleteTag(this)});$("#btnAddTag").on("click",function(){var a=document.getElementById("addTagInput").value;$.post("<?php echo PREFIX_LINK; ?>ajax/editObject/",{element:"addTag",id:document.getElementsByTagName("h1")[0].getAttribute("data-id-object"),name:a},function(c,b,e){!0===c.status?($("[data-delete="+c.id+"]").length||($(".tagList").append('<a class="tagIcon" href="'+c.PREFIX_LINK_LANG+"tag/"+c.id+"/"+c.nameToUrl+'/" data-id="'+c.id+'">'+a+'</a><span class="glyphicon glyphicon-remove-sign" data-delete="'+c.id+'"></span>'),$("[data-delete="+c.id+"]").on("click",function(){deleteTag(this)})),$("#addTagModal").modal("hide")):failAddTag(e,b,c.errMsg||translate("We can't recording the tag."))},"json").fail(function(a,b,e){failAddTag(a,b,e)})});$.get("<?php echo PREFIX_LINK; ?>ajax/tagList/",function(a){for(var c="",b=0,e=a.length;b<e;++b)c+='<option value="'+a[b].name+'">';document.getElementById("tagsList").innerHTML=c},"json");$("#addTagModal").on("shown.bs.modal",function(a){$("#addTagInput").focus()})});function deleteTag(a){var c=a.getAttribute("data-delete"),b=$("[data-id="+c+"]").text();$(a).removeClass("glyphicon-remove-sign").addClass("glyphicon-refresh");confirm(translate('Do you want to delete the "{{name}}" tag ?',{name:b}))&&$.post("<?php echo PREFIX_LINK; ?>ajax/editObject/",{element:"deleteTag",idObject:$("h1").attr("data-id-object"),idTag:c},function(a,b,c){!0===a.status?$("[data-id="+a.id+"], [data-delete="+a.id+"]").hide(500,function(){this.remove()}):failDeleteTag(c,b,a.errMsg||translate("We can't delete the tag."))},"json").fail(function(a,b,c){failDeleteTag(a,b,c)});$(a).removeClass("glyphicon-refresh").addClass("glyphicon-remove-sign")}function failDeleteTag(a,c,b){200!=a.status&&(b="HTTP ERROR "+a.status+" : "+a.statusText);alert(translate("An error occured on the delete of the tag.\nDetails : \n{{error}}",{error:b}))}function failAddTag(a,c,b){200!=a.status&&(b="HTTP ERROR "+a.status+" : "+a.statusText);alert(translate("An error occured on the adding of the tag.\nDetails : \n{{error}}",{error:b}))};